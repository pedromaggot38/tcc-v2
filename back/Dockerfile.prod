FROM node:22-alpine

WORKDIR /usr/src/app

COPY package*.json ./

# Instale dependências de produção e a CLI do Prisma (necessária no entrypoint)
RUN npm ci --only=production \
  && npm install prisma --no-save

COPY . .

RUN npx prisma generate

COPY ./scripts/init-db.sh .
RUN chmod +x ./init-db.sh

EXPOSE 3000

# Defina o script como o ponto de entrada do contêiner
ENTRYPOINT ["./init-db.sh"]

CMD ["npm", "run", "start:prod:docker"]